<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>考勤记录</title>
<meta name="renderer" content="webkit">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta name="viewport"
	content="width=device-width, initial-scale=1, maximum-scale=1">
<link rel="stylesheet" href="../lib/layui-v2.5.4/css/layui.css"
	media="all">
<link rel="stylesheet" href="../css/public.css" media="all">
</head>
<body>
	<div class="layuimini-container">
		<div class="layuimini-main">
			<fieldset class="layui-elem-field layuimini-search">
				<legend>搜索信息</legend>
				<div style="margin: 10px 10px 10px 10px">
					<form class="layui-form layui-form-pane" action="">
						<div class="layui-form-item">
							<div class="layui-inline">
								<label class="layui-form-label">机器号</label>
								<div class="layui-input-inline">
									<select name="device_sn" id="device_sn">

									</select>
								</div>
							</div>
							<div class="layui-inline">
								<label class="layui-form-label">搜索时间</label>
								<div class="layui-input-inline">
									<input type="text" class="layui-input" id="time"
										placeholder="请点击">
								</div>
							</div>

							<div class="layui-inline">
								<a class="layui-btn" lay-submit="" lay-filter="data-search-btn">搜索</a>
							</div>
						</div>
					</form>
				</div>
			</fieldset>

			<table class="layui-hide" id="currentTableId"
				lay-filter="currentTableFilter"></table>

		</div>
	</div>
	<script src="../lib/jquery-3.4.1/jquery-3.4.1.min.js"></script>
	<script src="../lib/layui-v2.5.4/layui.js" charset="utf-8"></script>

	<script>
		var url = 'http://localhost:8666/iclock/';
		$(function() {
			$.ajax({
				url : url + 'kaoqin/combobox',
				type : "GET",
				dataType : "json",
				success : function(result) {
					var htmls = '<option value="">请选择</option>'; //全局变量

					for ( var x in result) {
						htmls += '<option value = "' + result[x].id + '">'
								+ result[x].text + '</option>'

					}
					$("#device_sn").html(htmls);
				}
			});
			renderForm();
		});

		//重新渲染表单函数
		function renderForm() {
			layui.use('form', function() {
				var form = layui.form; //高版本建议把括号去掉，有的低版本，需要加()
				form.render();
			});
		}

		layui.use([ 'form', 'table' ], function() {
			var $ = layui.jquery, form = layui.form, table = layui.table;

			table.render({
				elem : '#currentTableId',
				url : url + "kaoqin/logList",
				cols : [ [ {
					field : 'user_pin',
					title : 'user_pin',
					align : 'center'
				}, {
					field : 'user_name',
					title : 'user_name',
					align : 'center'
				}, {
					field : 'verifyTypeStr',
					title : 'verifyTypeStr',
					align : 'center'
				}, {
					field : 'verify_time',
					title : 'verify_time',
					align : 'center',
					width : 180,
				}, {
					field : 'statusStr',
					title : 'statusStr',
					align : 'center'
				}, {
					field : 'work_code',
					title : 'work_code',
					align : 'center'
				}, {
					field : 'device_sn',
					title : 'device_sn',
					align : 'center',
					width : 180
				} ] ],

				limits : [ 10, 15, 20, 25, 50, 100 ],
				limit : 10,
				page : true
			});

			// 监听搜索操作
			form.on('submit(data-search-btn)', function(data) {
				//执行搜索重载
				table.reload('currentTableId', {
					page : {
						curr : 1
					},
					where : {
						device_sn : $("#device_sn").val(),
						time : $("#time").val()
					}
				}, 'data');

				return false;
			});

		});

		layui.use('laydate', function() {

			laydate = layui.laydate;
			laydate.render({
				elem : '#time',
				 range: '~',
				theme : '#393D49'
			});

		});
	</script>

</body>
</html>